<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        //判断是不是一个promise
        function isPromise(value) {
            if (typeof value === 'function' || (typeof value === 'undefined' && value != null)) {
                if (typeof value.then === 'function') {
                    return true;
                }
            }
            return false;
        }

        let all = function (values) {
            return new Promise((resolve, reject) => {
                let arr = [];
                let i = 0;
                let processData = function (key, value) {
                    arr[key] = value;
                    if (++i === values.length) {
                        resolve(arr)
                    }
                }
                for (let i = 0; i < values.length; i++) {
                    let current = values[i];
                    if (isPromise(current)) {   //判断传进来的是promise还是普通数据
                        current.then(y => {
                            processData(i, y)
                        }, reject)
                    } else {
                        processData(i, current)
                    }
                }
            })
        }

        //测试
        let p1 = new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve('OK');
            }, 1000);
        })
        let p2 = Promise.resolve('Success');
        let p3 = Promise.resolve('Oh Yeah');
        //调用
        const result1 = Promise.all([p1, p2, p3]);
        const result2 = all([p1, p2, p3]);

        setTimeout(function () {
            console.log(result1)
            console.log(result2)

            /*
            Promise {<fulfilled>: Array(3)}
            [[Prototype]]: Promise
            [[PromiseState]]: "fulfilled"
            [[PromiseResult]]: Array(3)
            0: "OK"
            1: "Success"
            2: "Oh Yeah"
            length: 3
            [[Prototype]]: Array(0)
            */
        }, 2000)
    </script>
</body>

</html>